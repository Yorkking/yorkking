---
title: 操作系统1
tags:
 - 计科所学
---

## 定义

An operating system is a program that acts as an interface between the user and the computer hardware and controls the execution of all kinds of programs.

操作系统是什么？

- 实际上是一个程序，在用户接触硬件资源的过程中扮演了一个接口的角色并且控制了程序的执行过程（实际上就是对CPU资源的控制），总结来说操作系统就是对计算机各种资源进行统一管理的程序。
- 管理的方面包括：
  - 内存管理（管理对内存（主存）资源的使用）
  - 处理器管理（管理对CPU资源的使用，特别是多处理的系统中）
  - 设备管理（管理对各种外部设备的使用：I/O，键盘，声卡，网卡等等，通过驱动（drivers）来管理）
  - 文件管理（对信息存储和获取的方式的管理）
    - 文件系统通过组织成目录：为了方便导航和使用。
      - 跟踪信息，定位，使用，状态等等，这些构成的整体成为文件系统；
  - 其他功能：
      - 安全性管理（访问权限资源的管理）
      - 控制系统性能：
        - 记录服务请求和系统响应之间的延迟
      - 作业统计：
        - 跟踪各种作业和用户使用的时间和资源
      - 错误检查工具



## 硬件资源

什么是硬件资源？

> 即物理实实在在存在的资源，比如声卡、网卡、显卡、键盘的输入、物理磁盘、CPU资源等等。
>
> 举例：显卡资源的利用，显示图像啊；网卡：接受和发送来自/去往网络的信息，磁盘资源存储信息。

如今的计算机架构

> [冯诺依曼体系架构](https://zh.wikipedia.org/wiki/冯·诺伊曼结构)：
>
> - 也称存储程序型电脑。把指令当成一种特别类型的静态数据，一台存储型电脑可轻易改变其程序，并在程序下改变其运算内容。
> - 把 CPU 与存储器分来，CPU 根据指令的不同来负责四种基本动作：
>   - 处理器-存储器之间传送数据
>   - 处理器-I/O 之间传送数据
>   - 数据处理：执行很多与数据相关的算术操作和逻辑操作
>   - 控制：跳转，影响下一次取值的地址（PC 的值）

计算机主要有 4 个结构化部件：

> - 处理器（Processor)：运算器和控制器。
> - 内存(Main memory)
> - 输入/输出模块(I/O)
> - 系统总线(System bus)：
>   
>   - [系统总线](https://zh.wikipedia.org/wiki/系統匯流排)：**系统总线**（英语：**System Bus**）是一个单独的电脑[总线](https://zh.wikipedia.org/wiki/匯流排)，是连接电脑系统的主要组件。这个技术的开发是用来降低成本和促进[模块化](https://zh.wikipedia.org/wiki/模組化)。系统总线结合[数据总线](https://zh.wikipedia.org/wiki/資料匯流排)的功能来搭载信息，[地址总线](https://zh.wikipedia.org/wiki/位址匯流排)来决定将信息送往何处，[控制总线](https://zh.wikipedia.org/wiki/控制匯流排)来决定如何动作。虽然系统总线于1970年代至1980年代广受欢迎，但是现代的电脑却使用不同的分离总线来做更多特定需求用途。
>   
>   - 1）总线周期：总线上两个部件完成一次完整且可靠的数据传输时间； 2）总线周期分为四个阶段： 
>     - 申请分配阶段：申请总线 
>     - 寻址阶段：发出地址及有关命令 
>     - 传数阶段：进行数据交换 
>     - 结束：从总线上撤除信号，让出总线
>
> 模块化视图如下：
>
> 处理器的一种功能就是与存储器交换数据。使用两个内部（对处理器而言）寄存器：存储器地址寄存器：明确下一次读/写的存储器地址；存储器缓冲寄存器：存放要写入存储器的数据或从存储器读取数据。同理，还有指定特定的输入/输出设备的缓冲寄存器，用于在输入/输出模块和处理器间交换数据。
>
> ![image-20200813095615509](../assets/image/image-20200813095615509.png)
>
> 

中断：

> 中断是指：计算机提供的允许**其他模块**（I/O、寄存器）中断**处理器**正常处理过程的机制。即其他模块发送一个请求给处理器，处理器暂停当前任务的过程。中断不是程序调用过程中的一个例程，它可以在任何时候发生，因而可以在用户执行过程中任何一点发生，不可预测。
>
> 中断的简单分类：
>
> ![image-20200813102042705](../assets/image/image-20200813102042705.png)

引入中断程序的指令周期

> ![image-20200813102404636](../assets/image/image-20200813102404636.png)

存储器的层次结构

> 局部性原理：
>
> - 时间局部性：同一个数据，在一段时间内，可能会被多次访问。
> - 空间局部性：如果某个数据被访问，那么与它相邻的数据项很可能也将被访问。

高速缓存

> 在处理器和内存之间提供一个容量很小但速度很快的存储器，称之为高速缓存。

直接内存存取 DMA

> 执行 I/O 操作的技术有三种：可编程 I/O、中断驱动 I/O 和直接内存存取（DMA）。
>
> - 可编程 I/O
>   - 处理器执行程序时遇到一个 I/O 相关的指令时，它会通过相应的 I/O 模块发送命令来执行这个命令。使用可编程I/O操作时，I/O 模块执行请求的动作并设置 I/O 状态寄存器中的相应的位，但它并不会进一步通知处理器，尤其**不会中断处理器**。因此处理器需要在执行 I/O 指令后，还要**定期检查** I/O 模块的状态，以确定 I/O 操作是否完成。
> - 中断驱动 I/O
>   - 处理器给 I/O 模块发送 I/O 命令，然后处理器继续做其他一些有用的工作。当 I/O 模块准备好与处理器交换数据时，它将打断处理器的执行并请求服务。处理器和前面一样执行数据传送，然后恢复处理器以前的执行过程。
>
> 以上两种 I/O 都需要处理器参与数据的传送，有两方面的固有缺陷：
>
> - I/O 传送速度受限于处理器测试设备和提供服务的速度
> - 处理器忙于管理 I/O 传送的工作，必须执行很多指令以完成 I/O 传送
>
> 需要移动大量数据时，有一种更有效的技术为：直接内存存取(Direct Memory Access)。
>
> DMA 功能可以由**系统总线**中的一个**独立模块**完成，也可以并入 I/O 模块。该技术的工作方式如下：
>
> - 在处理器读或写一块数据时，给 DMA 模块产生一条命令，发送以下信息：
>   - 是否请求一次读或写
>   - 所涉 I/O 设备的地址
>   - 开始读或写的存储器单元
>   - 需要读或写的字数
> - 之后处理器继续执行其他工作。处理器直接把这个操作委托给 DMA 模块负责处理。DMA　模块直接与存储器交互，传送整个数据块，每次传送一个字。这个过程不需要处理器参与，传送完成后，DMA 模块向处理器发送一个中断信号。因此，只有开始传送和结束传送的时候，处理器才会参与。
>
> 但是，DMA 模块需要控制总线来与存储器进行数据传送。由于总线的使用中存在竞争，当处理器需要使用总线时，要等待 DMA 模块。这并不是一个中断，处理器没有保存上下文环境去做其他事情，而只是暂停一个总线周期（总线上传输一个字的时间）。因此，在 DMA 传送过程中，当处理器需要访问总线时，处理器执行速度会变慢。



